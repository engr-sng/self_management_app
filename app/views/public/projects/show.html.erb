<div class="wrapper">
  <div class="container flex-box">
    <div class="box-100">
      <h2><%= @project.title %></h2>
      <p><%= @project.description %></p>
    </div>

    <div class="box-25">
      <div class="announcement_header">
        <h3>オーナー</h3>
      </div>
      <div class="announcement_body">
        <p><%= @project.user.display_name %></p>
      </div>
    </div>

    <div class="box-25">
      <div class="announcement_header">
        <h3>期間</h3>
      </div>
      <div class="announcement_body">
        <p><%= @project.project_start_date %>～<%= @project.project_end_date %></p>
      </div>
    </div>

    <div class="box-25">
      <div class="announcement_header">
        <h3>ステータス</h3>
      </div>
      <div class="announcement_body">
        <p><%= @project.project_status %></p>
      </div>
    </div>

    <div class="box-25">
      <div class="announcement_header">
        <h3>進捗率</h3>
      </div>
      <div class="announcement_body">
        <p><%= @project.project_progress %>%</p>
      </div>
    </div>

    <div class="box-100">
      <%= link_to "プロジェクトを編集する", edit_project_path(@project.id), method: :get, class: "btn green-color" %>
    </div>

    <div class="box-100">
      <h2>プロジェクトメンバー</h2>
    </div>

    <div class="box-100">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>表示名</th>
              <th>ユーザーネーム</th>
              <th>プロジェクト権限</th>
              <th>タスク進捗率</th>
            </tr>
          </thead>
          <tbody>
            <% @project.project_members.each do |project_member| %>
            <tr>
              <td><%= link_to project_member.user.display_name, project_project_member_path(@project.id,project_member.id), method: :get %></td>
              <td><%= project_member.user.user_name %></td>
              <td><%= project_member.permission_i18n %></td>
              <td><%= @project.project_member_task_progress(project_member.user_id) %>%</td>
            </tr>
          </tbody>
          <% end %>
        </table>
      </div>
    </div>

    <div class="box-100">
      <%= link_to "メンバーを追加する", new_project_project_member_path(@project.id), method: :get, class: "btn green-color" %>
    </div>

    <div class="box-100">
      <h2>ガントチャート</h2>
    </div>

    <div class="box-100">
      <div class="gantt-chart-container">
        <table class="gantt-chart">
          <thead>
            <tr>
              <th>WBS</th>
              <th>タスク</th>
              <th>開始日</th>
              <th>終了日</th>
              <th>ステータス</th>
              <th>進捗率</th>
              <th>担当者</th>
              <% if (@project.project_start_date.class == Date) && (@project.project_end_date.class == Date) %>
                <% (@project.project_start_date..@project.project_end_date).each do |day| %>
                <th><%= day.strftime("%m/%d") %></th>
                <% end %>
              <% end %>
            </tr>
          </thead>

          <tbody>
            <% @project.parent_tasks.order(display_order: :ASC).each do |parent_task| %>
            <tr>
              <td><%= parent_task.display_order %></td>
              <td><i class="fa fa-folder-open"></i><%= link_to parent_task.title, project_parent_task_path(@project.id,parent_task.id), method: :get %></td>
              <td><%= parent_task.parent_task_start_date %></td>
              <td><%= parent_task.parent_task_end_date %></td>
              <td><%= parent_task.parent_task_status %></td>
              <td><%= parent_task.parent_task_progress %>%</td>
              <td></td>
              <% if (@project.project_start_date.class == Date) && (@project.project_end_date.class == Date) %>
                <% (@project.project_start_date..@project.project_end_date).each do |day| %>
                <td class="<%= parent_task.date_comparison(day) %>"></td>
                <% end %>
              <% end %>
            </tr>
              <% parent_task.child_tasks.order(display_order: :ASC).each do |child_task| %>
              <tr>
                <td><%= parent_task.display_order %>-<%= child_task.display_order %></td>
                <td><i class="fa fa-right-from-bracket"></i><%= link_to child_task.title, project_child_task_path(@project.id,child_task.id), method: :get %></td>
                <td><%= child_task.start_date %></td>
                <td><%= child_task.end_date %></td>
                <td><%= child_task.status_i18n %></td>
                <td><%= child_task.progress %>%</td>
                <td><%= child_task.user.display_name %></td>
                <% if (@project.project_start_date.class == Date) && (@project.project_end_date.class == Date) %>
                  <% (@project.project_start_date..@project.project_end_date).each do |day| %>
                  <td class="<%= child_task.date_comparison(day) %>"></td>
                  <% end %>
                <% end %>
              </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <div class="box-100">
      <%= link_to "親タスクを追加する", new_project_parent_task_path(@project.id), method: :get, class: "btn green-color" %>
      <%= link_to "子タスクを追加する", new_project_child_task_path(@project.id), method: :get, class: "btn green-color" %>
    </div>

  </div>
</div>
